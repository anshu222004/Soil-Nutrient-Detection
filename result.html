<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AQI Result | AirSafe</title>
<style>
  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    color: #333;
    position: relative;
    overflow-x: hidden;
  }

  /* Blurred background */
  body::before {
    content: "";
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: url('air.png') center/cover no-repeat;
    filter: blur(8px) brightness(0.7);
    z-index: -2;
  }

  h1 {
    text-align: center;
    margin-top: 30px;
    color: #b59000;
    text-shadow: 1px 1px 2px #fff;
  }

  .container {
    display: flex;
    justify-content: center;
    margin-top: 40px;
    gap: 40px;
  }

  /* Table */
  table {
    border-collapse: collapse;
    width: 400px;
    background-color: rgba(237, 222, 164, 0.95);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    transition: transform 0.3s;
  }
  table:hover { transform: scale(1.03); }
  th, td { border: 2px solid #333; padding: 12px; font-size: 16px; text-align: left; }
  th { background-color: #b59000; color: white; }
  tr:hover { background-color: rgba(0,0,0,0.1); }

  /* Status & suggestion */
  .status, .suggestion {
    font-size: 18px;
    font-weight: bold;
    margin-top: 15px;
    padding: 12px;
    border-radius: 10px;
    display: inline-block;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  /* Chart container */
  .chart-container {
    width: 500px;
    height: 400px;
    position: relative;
    cursor: pointer;
    transition: transform 0.3s;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    border-radius: 15px;
    overflow: hidden;
    background-color: rgba(252, 235, 169, 0.95);
  }
  .chart-container:hover { transform: scale(1.05); }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 10;
    padding-top: 50px;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.7);
  }
  .modal-content {
    margin: auto;
    background-color: white;
    padding: 20px;
    width: 80%;
    border-radius: 15px;
    position: relative;
    animation: popin 0.5s ease;
  }
  @keyframes popin {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  .close-btn {
    position: absolute;
    top: 10px; right: 20px;
    font-size: 28px;
    font-weight: bold;
    color: #333;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>üå´Ô∏è AQI Prediction Result</h1>

<div class="container">
  <div id="resultTableContainer">
    <table id="resultTable"></table>
    <div id="aqiStatus" class="status"></div>
    <div id="suggestion" class="suggestion"></div>
  </div>

  <div class="chart-container" onclick="openModal()">
    <canvas id="aqiChart"></canvas>
  </div>
</div>

<!-- Modal -->
<div id="chartModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <canvas id="modalChart"></canvas>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const params = new URLSearchParams(window.location.search);
const date = params.get('date');
const holidays_count = Number(params.get('holidays_count'));
const days = Number(params.get('days'));
const pm25 = Number(params.get('pm25'));
const pm10 = Number(params.get('pm10'));
const no2 = Number(params.get('no2'));
const so2 = Number(params.get('so2'));
const co = Number(params.get('co'));
const ozone = Number(params.get('ozone'));
const aqi = (pm25 + pm10 + no2 + so2 + co + ozone)/6;
let status="", bgColor="", advice="";
if(aqi<=50){status="Good"; bgColor="green"; advice="Safe to go outside.";}
else if(aqi<=100){status="Moderate"; bgColor="#b59000"; advice="Sensitive groups limit outdoor activity.";}
else if(aqi<=150){status="Unhealthy for Sensitive Groups"; bgColor="orange"; advice="Sensitive groups should reduce outdoor activity.";}
else if(aqi<=200){status="Unhealthy"; bgColor="red"; advice="Everyone may experience health effects. Limit outdoor exposure.";}
else if(aqi<=300){status="Very Unhealthy"; bgColor="purple"; advice="Health alert! Stay indoors.";}
else{status="Hazardous"; bgColor="maroon"; advice="Emergency! Stay indoors, wear mask and use air purifiers.";}

document.getElementById('resultTable').innerHTML = `
<tr><th>Parameter</th><th>Value</th></tr>
<tr><td>Date</td><td>${date}</td></tr>
<tr><td>Holidays Count</td><td>${holidays_count}</td></tr>
<tr><td>Day of Week</td><td>${days}</td></tr>
<tr><td>PM2.5</td><td>${pm25}</td></tr>
<tr><td>PM10</td><td>${pm10}</td></tr>
<tr><td>NO2</td><td>${no2}</td></tr>
<tr><td>SO2</td><td>${so2}</td></tr>
<tr><td>CO</td><td>${co}</td></tr>
<tr><td>Ozone</td><td>${ozone}</td></tr>
<tr><td>Predicted AQI</td><td>${aqi.toFixed(2)}</td></tr>
`;

document.getElementById('aqiStatus').textContent = status;
document.getElementById('aqiStatus').style.backgroundColor = bgColor;
document.getElementById('aqiStatus').style.color = (aqi<=100)?'black':'white';
document.getElementById('suggestion').textContent = advice;
document.getElementById('suggestion').style.backgroundColor = bgColor;
document.getElementById('suggestion').style.color = (aqi<=100)?'black':'white';

// Chart with danger zone overlay
const ctx = document.getElementById('aqiChart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'bar',
  data: {
    labels: ['PM2.5','PM10','NO2','SO2','CO','Ozone'],
    datasets:[{
      label:'Pollutant Levels',
      data:[pm25,pm10,no2,so2,co,ozone],
      backgroundColor:['#ff6384','#ff9f40','#ffcd56','#4bc0c0','#36a2eb','#9966ff']
    }]
  },
  options:{
    plugins:{legend:{display:false}, title:{display:true, text:'Click to enlarge chart'}},
    scales:{y:{beginAtZero:true}}
  }
});

// Modal chart with danger zone highlighted
const modalCtx = document.getElementById('modalChart').getContext('2d');
const modalChart = new Chart(modalCtx, {
  type:'bar',
  data:chart.data,
  options:{
    plugins:{
      legend:{display:false},
      title:{display:true,text:'Pollutant Levels & Danger Zone'}
    },
    scales:{
      y:{
        beginAtZero:true,
        max: Math.max(pm25,pm10,no2,so2,co,ozone,150)+50,
      }
    },
  },
});

// Modal
const modal = document.getElementById("chartModal");
function openModal(){ modal.style.display="block"; }
function closeModal(){ modal.style.display="none"; }
</script>

<style>
/* Interactive tooltip styles */
.tooltip {
  position: relative;
  cursor: pointer;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 250px;
  background-color: rgba(0,0,0,0.85);
  color: #fff;
  text-align: left;
  padding: 10px;
  border-radius: 10px;
  font-size: 14px;
  position: absolute;
  z-index: 10;
  top: 50%;
  left: 105%;
  transform: translateY(-50%) scale(0.8);
  opacity: 0;
  transition: all 0.3s ease;
  pointer-events: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
  transform: translateY(-50%) scale(1);
}

/* Color-coded ranges inside tooltip */
.safe { color: #4CAF50; font-weight: bold; }
.moderate { color: #b59000; font-weight: bold; }
.danger { color: #FF0000; font-weight: bold; }
</style>

<script>
// Safe/Danger Ranges for each parameter
const ranges = {
  "PM2.5":"<span class='safe'>Safe: 0-50</span><br><span class='moderate'>Moderate: 51-100</span><br><span class='danger'>Danger: 101+</span>",
  "PM10":"<span class='safe'>Safe: 0-50</span><br><span class='moderate'>Moderate: 51-100</span><br><span class='danger'>Danger: 101+</span>",
  "NO2":"<span class='safe'>Safe: 0-40</span><br><span class='moderate'>Moderate: 41-80</span><br><span class='danger'>Danger: 81+</span>",
  "SO2":"<span class='safe'>Safe: 0-40</span><br><span class='moderate'>Moderate: 41-80</span><br><span class='danger'>Danger: 81+</span>",
  "CO":"<span class='safe'>Safe: 0-2</span><br><span class='moderate'>Moderate: 2.1-10</span><br><span class='danger'>Danger: 10+</span>",
  "Ozone":"<span class='safe'>Safe: 0-50</span><br><span class='moderate'>Moderate: 51-100</span><br><span class='danger'>Danger: 101+</span>",
  "AQI":"<span class='safe'>Safe: 0-100</span><br><span class='moderate'>Moderate: 101-150</span><br><span class='danger'>Danger: 151+</span>"
};
</script>

<style>
/* Interactive tooltip styles */
.tooltip {
  position: relative;
  cursor: pointer;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 250px;
  background-color: rgba(0,0,0,0.85);
  color: #fff;
  text-align: left;
  padding: 10px;
  border-radius: 10px;
  font-size: 14px;
  position: absolute;
  z-index: 10;
  top: 50%;
  left: 105%;
  transform: translateY(-50%) scale(0.8);
  opacity: 0;
  transition: all 0.3s ease;
  pointer-events: none;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
  transform: translateY(-50%) scale(1);
}

/* Color-coded ranges inside tooltip */
.safe { color: #4CAF50; font-weight: bold; }
.moderate { color: #b59000; font-weight: bold; }
.danger { color: #FF0000; font-weight: bold; }
</style>



<!-- <script>
// Values coming from Flask (machine learning model)
const date = "{{ date }}";
const holidays_count = {{ holidays_count }};
const days = {{ days }};
const pm25 = {{ pm25 }};
const pm10 = {{ pm10 }};
const no2 = {{ no2 }};
const so2 = {{ so2 }};
const co = {{ co }};
const ozone = {{ ozone }};
const aqi = {{ aqi }};
const level = "{{ level }}";
const bgColor = "{{ color }}";
const advice = "{{ suggestion }}";

// Insert into table
document.getElementById('resultTable').innerHTML = `
<tr><th>Parameter</th><th>Value</th></tr>
<tr><td>Date</td><td>${date}</td></tr>
<tr><td>Holidays Count</td><td>${holidays_count}</td></tr>
<tr><td>Day of Week</td><td>${days}</td></tr>
<tr><td>PM2.5</td><td>${pm25}</td></tr>
<tr><td>PM10</td><td>${pm10}</td></tr>
<tr><td>NO2</td><td>${no2}</td></tr>
<tr><td>SO2</td><td>${so2}</td></tr>
<tr><td>CO</td><td>${co}</td></tr>
<tr><td>Ozone</td><td>${ozone}</td></tr>
<tr><td>Predicted AQI</td><td>${aqi.toFixed(2)}</td></tr>
`;

// AQI Status Box
document.getElementById('aqiStatus').textContent = level;
document.getElementById('aqiStatus').style.backgroundColor = bgColor;

// Suggestion Box
document.getElementById('suggestion').textContent = advice;
document.getElementById('suggestion').style.backgroundColor = bgColor;
</script> -->

<script>
  function predictAQI() {
    // get input values
    const dateInput = document.getElementById('date').value;
    const holidays_count = document.getElementById('holidays_count').value;
    const days = document.getElementById('days').value;
    const pm25 = document.getElementById('pm25').value;
    const pm10 = document.getElementById('pm10').value;
    const no2 = document.getElementById('no2').value;
    const so2 = document.getElementById('so2').value;
    const co = document.getElementById('co').value;
    const ozone = document.getElementById('ozone').value;

    // Basic validation (optional)
    if (!dateInput || pm25==="" || pm10==="" || no2==="" || so2==="" || co==="" || ozone==="" ) {
      alert("Please fill all required fields.");
      return;
    }

    // Build URL params and redirect to result_ml.html (the ML-enabled result page)
    const params = new URLSearchParams({
      date: dateInput,
      holidays_count, days, pm25, pm10, no2, so2, co, ozone
    }).toString();

    // Redirect to result_ml.html (not result.html)
    window.location.href = result_ml.html?$:{params};
  }
</script>


</body>
</html>
